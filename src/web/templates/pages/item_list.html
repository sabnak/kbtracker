{% extends "base.html" %}

{% block title %}Items - King's Bounty Tracker{% endblock %}

{% block content %}
<div class="row">
	<div class="col-md-12">
		<h1 class="mb-4">Items for {{ game.name }}</h1>

		<div class="card mb-4">
			<div class="card-body">
				<form method="GET" action="/games/{{ game.id }}/items">
					<div class="input-group">
						<input type="text" class="form-control" name="query" placeholder="Search items..." value="{{ query }}">
						<button class="btn btn-primary" type="submit">Search</button>
						<a href="/games/{{ game.id }}/items" class="btn btn-secondary">Clear</a>
					</div>
				</form>
			</div>
		</div>

		{% if items_with_sets %}
		<div class="table-responsive">
			<table class="table table-striped table-hover">
				<thead>
					<tr>
						<th>Name</th>
						<th>Price</th>
						<th>Level</th>
						<th>Type</th>
					</tr>
				</thead>
				<tbody>
					{% for item_data in items_with_sets %}
					{% set item = item_data.item %}
					<tr>
						<td>
							<strong>{{ item.name }}</strong><br>
							{% if item.hint %}
							<small class="text-muted">{{ item.hint|format_text|safe }}</small>
							{% else %}
							<small class="text-muted">No description</small>
							{% endif %}

							{% if item_data.item_set %}
							<div class="set-info">
								{% if item_data.item_set.hint %}
								<div class="set-hint">
									<strong>Set: {{ item_data.item_set.name }}</strong><br>
									{{ item_data.item_set.hint|format_text|safe }}
								</div>
								{% endif %}

								{% if item_data.set_items %}
								<ul class="set-items">
									{% for set_item in item_data.set_items %}
									<li class="{% if set_item.id == item.id %}current-item{% endif %}">
										{{ set_item.name }}
									</li>
									{% endfor %}
								</ul>
								{% endif %}
							</div>
							{% endif %}
						</td>
						<td>{{ item.price|format_price }}</td>
						<td>
							<span class="quality-{{ item.level }}">{{ item.level }}</span>
						</td>
						<td>
							{% if item.propbits %}
							<small>{{ ', '.join(item.propbits[:3]) }}</small>
							{% else %}
							-
							{% endif %}
						</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
		{% else %}
		<div class="alert alert-info">
			No items found. {% if not query %}Scan game files first to populate the database.{% else %}Try a different search query.{% endif %}
		</div>
		{% endif %}

		<div class="alert alert-secondary mt-4">
			<h5>Note:</h5>
			<p>This is a read-only view of game items. To track items to shops, visit a profile's "View Tracked Items" page.</p>
		</div>

		<div class="mt-3">
			<a href="/games" class="btn btn-secondary">Back to Games</a>
		</div>
	</div>
</div>
{% endblock %}

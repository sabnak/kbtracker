{% extends "base.html" %}

{% block title %}Items - King's Bounty Tracker{% endblock %}

{% block content %}
<div class="row">
	<div class="col-md-12">
		<h1 class="mb-4">Items for {{ profile.name }}</h1>

		<div class="card mb-4">
			<div class="card-body">
				<form method="GET" action="/profiles/{{ profile.id }}/items">
					<div class="input-group">
						<input type="text" class="form-control" name="query" placeholder="Search items..." value="{{ query }}">
						<button class="btn btn-primary" type="submit">Search</button>
						<a href="/profiles/{{ profile.id }}/items" class="btn btn-secondary">Clear</a>
					</div>
				</form>
			</div>
		</div>

		{% if items %}
		<div class="table-responsive">
			<table class="table table-striped table-hover">
				<thead>
					<tr>
						<th>Name</th>
						<th>Price</th>
						<th>Type</th>
						<th>Actions</th>
					</tr>
				</thead>
				<tbody>
					{% for item in items %}
					<tr>
						<td>
							<strong>{{ item.name }}</strong><br>
							<small class="text-muted">{{ item.hint[:100] if item.hint else 'No description' }}</small>
						</td>
						<td>{{ item.price }}</td>
						<td>
							{% if item.propbits %}
							<small>{{ ', '.join(item.propbits[:3]) }}</small>
							{% else %}
							-
							{% endif %}
						</td>
						<td>
							<a href="/profiles/{{ profile.id }}/items/{{ item.id }}/track" class="btn btn-sm btn-primary">Track</a>
						</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
		{% else %}
		<div class="alert alert-info">
			No items found. {% if not query %}Scan game files first to populate the database.{% else %}Try a different search query.{% endif %}
		</div>
		{% endif %}

		<div class="mt-3">
			<a href="/" class="btn btn-secondary">Back to Profiles</a>
			<a href="/profiles/{{ profile.id }}/tracked" class="btn btn-info">View Tracked Items</a>
		</div>
	</div>
</div>
{% endblock %}
